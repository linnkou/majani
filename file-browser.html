<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>استعراض الملفات - التعليم الجزائري</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f4f8;
      color: #333;
      direction: rtl;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #007bff;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      background: white;
      margin: 8px 0;
      padding: 12px 16px;
      border-radius: 6px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      transition: background 0.3s;
    }
    li:hover {
      background: #e9f5ff;
    }
    a {
      color: #007bff;
      text-decoration: none;
      font-weight: bold;
    }
    a:hover {
      text-decoration: underline;
    }
    .icon {
      margin-left: 10px;
    }
    .empty-msg {
      text-align: center;
      color: #777;
      margin-top: 30px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h2>📁 استعراض الملفات - التعليم الجزائري</h2>
  <ul id="file-list"></ul>
  <p id="empty-message" class="empty-msg" style="display: none;">📭 لا توجد ملفات في هذا المجلد.</p>

  <script>
    const username = "linnkou";
    const repo = "majani";
    const branch = "main";

    const urlParams = new URLSearchParams(window.location.search);
    const path = urlParams.get("path") || "";

    const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${path}?ref=${branch}`;

    fetch(apiUrl)
      .then((res) => {
        if (!res.ok) throw new Error("404");
        return res.json();
      })
      .then((data) => {
        const list = document.getElementById("file-list");
        const filtered = data.filter(item => item.name !== ".gitkeep");
        if (filtered.length === 0) {
          document.getElementById("empty-message").style.display = "block";
          return;
        }
        filtered.forEach((item) => {
          const li = document.createElement("li");
          const link = document.createElement("a");

          if (item.type === "dir") {
            const subPath = `${path}/${item.name}`;
            link.href = `file-browser-dynamic.html?path=${encodeURIComponent(subPath)}`;
            link.innerHTML = `<span class="icon">📁</span> ${item.name}`;
          } else {
            link.href = item.download_url;
            link.target = "_blank";
            link.innerHTML = `<span class="icon">📄</span> ${item.name}`;
          }

          li.appendChild(link);
          list.appendChild(li);
        });
      })
      .catch((err) => {
        document.getElementById("empty-message").textContent = "📭 لا توجد ملفات في هذا المجلد أو حدث خطأ.";
        document.getElementById("empty-message").style.display = "block";
      });
  </script>
</body>
</html>
