<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª - Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f4f8;
      color: #333;
      direction: rtl;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #007bff;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      background: white;
      margin: 8px 0;
      padding: 12px 16px;
      border-radius: 6px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      transition: background 0.3s;
    }
    li:hover {
      background: #e9f5ff;
    }
    a {
      color: #007bff;
      text-decoration: none;
      font-weight: bold;
    }
    a:hover {
      text-decoration: underline;
    }
    .icon {
      margin-left: 10px;
    }
    .empty-msg {
      text-align: center;
      color: #777;
      margin-top: 30px;
      font-size: 18px;
    }
    .breadcrumb {
      background-color: white;
      padding: 10px 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .breadcrumb a {
      margin: 0 5px;
    }
    .error-details {
      background-color: #fff3cd;
      padding: 15px;
      border-radius: 6px;
      margin-top: 15px;
      border-left: 4px solid #ffc107;
    }
    .back-button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 20px;
      display: inline-block;
    }
    .back-button:hover {
      background-color: #0069d9;
    }
    .loader {
      border: 5px solid #f3f3f3;
      border-top: 5px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 30px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <h2>ğŸ“ Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª - Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ</h2>
  
  <div class="breadcrumb" id="breadcrumb-container">
    <a href="file-browser.html"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  </div>
  
  <div id="loader" class="loader"></div>
  <ul id="file-list" style="display: none;"></ul>
  <p id="empty-message" class="empty-msg" style="display: none;">ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ù„Ø¯.</p>
  <div id="error-container" class="error-details" style="display: none;"></div>
  
  <button class="back-button" id="back-button" style="display: none;">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>

  <script>
    const username = "linnkou";
    const repo = "majani";
    const branch = "main";
    const rootFolder = "educationdzwordland"; // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ

    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø³Ø§Ø± Ù…Ù† Ø¹Ù†ÙˆØ§Ù† URL
    const urlParams = new URLSearchParams(window.location.search);
    const path = urlParams.get("path") || "";
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø±
    const fullPath = path ? `${rootFolder}/${path}` : rootFolder;
    const encodedPath = fullPath.split("/").map(encodeURIComponent).join("/");
    const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${encodedPath}?ref=${branch}`;
    
    // ØªØ­Ø¯ÙŠØ« Ù…Ø³Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ (Breadcrumb)
    function updateBreadcrumb() {
      const container = document.getElementById("breadcrumb-container");
      container.innerHTML = '<a href="file-browser.html"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>';
      
      if (path) {
        const parts = path.split('/');
        let currentPath = '';
        
        parts.forEach((part, index) => {
          currentPath += (index > 0 ? '/' : '') + part;
          container.innerHTML += ` / <a href="file-browser.html?path=${encodeURIComponent(currentPath)}">${part}</a>`;
        });
      }
    }
    
    // ØªÙ†ÙÙŠØ° Ø§Ù„ØªÙ†Ù‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù„Ù
    document.getElementById("back-button").addEventListener("click", function() {
      const pathParts = path.split('/');
      pathParts.pop(); // Ø¥Ø²Ø§Ù„Ø© Ø¢Ø®Ø± Ù‚Ø³Ù… Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø±
      const newPath = pathParts.join('/');
      
      // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¹Ù„Ù‰
      if (newPath) {
        window.location.href = `file-browser.html?path=${encodeURIComponent(newPath)}`;
      } else {
        window.location.href = "file-browser.html"; // Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
      }
    });
    
    // ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¬Ù„Ø¯
    function loadDirectoryContent() {
      fetch(apiUrl)
        .then(response => {
          if (!response.ok) {
            if (response.status === 404) {
              throw new Error("Ø§Ù„Ù…Ø¬Ù„Ø¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø±.");
            }
            throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© (${response.status})`);
          }
          return response.json();
        })
        .then(data => {
          document.getElementById("loader").style.display = "none";
          document.getElementById("file-list").style.display = "block";
          
          const list = document.getElementById("file-list");
          list.innerHTML = ""; // Ù…Ø³Ø­ Ø£ÙŠ Ù…Ø­ØªÙˆÙ‰ Ø³Ø§Ø¨Ù‚
          
          // ØªØµÙÙŠØ© Ø§Ù„Ù…Ù„ÙØ§Øª (Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ .gitkeep)
          const filtered = Array.isArray(data) ? data.filter(item => item.name !== ".gitkeep") : [];
          
          if (filtered.length === 0) {
            document.getElementById("empty-message").style.display = "block";
            return;
          }
          
          // Ø¹Ø±Ø¶ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ Ù…Ø¬Ù„Ø¯ ÙØ±Ø¹ÙŠ
          if (path) {
            document.getElementById("back-button").style.display = "inline-block";
          }
          
          // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ±: Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ù„Ù…Ù„ÙØ§Øª
          const sortedItems = [...filtered].sort((a, b) => {
            if (a.type === b.type) return a.name.localeCompare(b.name);
            return a.type === "dir" ? -1 : 1;
          });
          
          // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
          sortedItems.forEach(item => {
            const li = document.createElement("li");
            const link = document.createElement("a");
            
            if (item.type === "dir") {
              // Ø§Ù„Ù…Ø³Ø§Ø± Ù„Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„ÙØ±Ø¹ÙŠ
              const subPath = path ? `${path}/${item.name}` : item.name;
              link.href = `file-browser.html?path=${encodeURIComponent(subPath)}`;
              link.innerHTML = `<span class="icon">ğŸ“</span> ${item.name}`;
            } else {
              // Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù…Ù„Ù
              link.href = item.download_url;
              link.target = "_blank";
              
              // ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
              let icon = "ğŸ“„";
              const ext = item.name.split('.').pop().toLowerCase();
              if (["pdf"].includes(ext)) icon = "ğŸ“•";
              if (["doc", "docx"].includes(ext)) icon = "ğŸ“˜";
              if (["xls", "xlsx"].includes(ext)) icon = "ğŸ“Š";
              if (["ppt", "pptx"].includes(ext)) icon = "ğŸ“‹";
              if (["jpg", "jpeg", "png", "gif"].includes(ext)) icon = "ğŸ–¼ï¸";
              
              link.innerHTML = `<span class="icon">${icon}</span> ${item.name}`;
            }
            
            li.appendChild(link);
            list.appendChild(li);
          });
        })
        .catch(err => {
          console.error("Ø­Ø¯Ø« Ø®Ø·Ø£:", err);
          document.getElementById("loader").style.display = "none";
          document.getElementById("empty-message").style.display = "block";
          document.getElementById("empty-message").textContent = "ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø£Ùˆ Ø­Ø¯Ø« Ø®Ø·Ø£.";
          
          // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£ ÙÙŠ ÙˆØ­Ø¯Ø© Ù…Ù†ÙØµÙ„Ø©
          const errorContainer = document.getElementById("error-container");
          errorContainer.style.display = "block";
          errorContainer.innerHTML = `
            <strong>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:</strong><br>
            ${err.message}<br><br>
            <strong>Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> ${fullPath}<br>
            <em>ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø¬Ù„Ø¯ ÙˆØ§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</em>
          `;
          
          // Ø¹Ø±Ø¶ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¯Ø§Ø¦Ù…Ù‹Ø§ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
          document.getElementById("back-button").style.display = "inline-block";
        });
    }
    
    // ØªØ­Ø¯ÙŠØ« Ù…Ø³Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener("DOMContentLoaded", function() {
      updateBreadcrumb();
      loadDirectoryContent();
    });
  </script>
</body>
</html>
