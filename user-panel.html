
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>لوحة المستخدم</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body style="font-family: Arial; max-width: 600px; margin: auto; padding-top: 60px;">
  <h2>📤 رفع ملف وورد</h2>
  <label>اختر الطور:</label>
  <select id="stage">
    <option value="primary">ابتدائي</option>
    <option value="middle">متوسط</option>
    <option value="secondary">ثانوي</option>
  </select><br><br>
  <label>السنة:</label><input type="text" id="year" placeholder="مثال: السنة-الثانية" /><br><br>
  <label>المادة:</label><input type="text" id="subject" placeholder="مثال: اللغة-العربية" /><br><br>
  <input type="file" id="fileInput" accept=".doc,.docx" />
  <button onclick="upload()">رفع الملف</button>
  <p id="msg"></p>

  <script>
    async function upload() {
      const file = document.getElementById('fileInput').files[0];
      const stage = document.getElementById('stage').value;
      const year = document.getElementById('year').value.trim();
      const subject = document.getElementById('subject').value.trim();
      const msg = document.getElementById('msg');

      if (!file || !year || !subject) {
        msg.innerText = "❗ الرجاء ملء جميع الحقول واختيار ملف.";
        return;
      }

      if (!file.name.endsWith('.doc') && !file.name.endsWith('.docx')) {
        msg.innerText = '❌ يجب رفع ملفات وورد فقط (.doc, .docx)';
        return;
      }

      const reader = new FileReader();
      reader.onload = async function() {
        const base64File = reader.result.split(',')[1];
        const path = `data/${stage}/${year}/${subject}/${file.name}`;
        const token = localStorage.getItem('github_token');
        if (!token) {
          msg.innerText = "❌ لم يتم تسجيل الدخول كمسؤول.";
          return;
        }

        const res = await fetch(`https://api.github.com/repos/linnkou/majani/contents/${path}`, {
          method: "PUT",
          headers: {
            "Authorization": "token " + token,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "إضافة ملف من المستخدم",
            content: base64File,
            branch: "main"
          })
        });

        if (res.ok) {
          msg.innerText = "✅ تم رفع الملف بنجاح!";
        } else {
          const err = await res.json();
          msg.innerText = "❌ فشل في رفع الملف: " + (err.message || "خطأ غير معروف");
        }
      };
      reader.readAsDataURL(file);
    }
  </script>
</body>
</html>
