<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة تحكم الأدمن</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    header {
      background: #2c3e50;
      color: white;
      padding: 20px;
      text-align: center;
    }
    nav {
      margin: 20px 0;
      text-align: center;
    }
    nav button {
      padding: 10px 20px;
      margin: 5px;
      border-radius: 8px;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    .user-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .user-table th, .user-table td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    .approve-btn {
      background: #27ae60;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .delete-btn {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .status-approved {
      color: green;
      font-weight: bold;
    }
    .status-pending {
      color: orange;
      font-weight: bold;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
  </style>
</head>
<body>
  <header>
    <div class="top-bar">
      <h1>لوحة تحكم الأدمن</h1>
      <div>
        <button onclick="goToSite()" style="margin-left: 10px;">🏠 الدخول إلى الموقع</button>
        <button onclick="logoutUser()">🚪 تسجيل الخروج</button>
      </div>
    </div>
  </header>

  <nav>
    <button onclick="showTab('users')">👥 إدارة المستخدمين</button>
    <button onclick="showTab('uploads')">📁 الملفات المرفوعة</button>
    <button onclick="showTab('browser-files')">📂 موافقة ملفات النظام</button>
  </nav>

  <div id="tab-users">
    <table class="user-table">
      <thead>
        <tr>
          <th>اسم المستخدم</th>
          <th>البريد الإلكتروني</th>
          <th>كلمة المرور</th>
          <th>الحالة</th>
          <th>الإجراء</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>
  </div>

  <div id="tab-uploads" style="display:none;">
    <table class="user-table">
      <thead>
        <tr>
          <th>السنة</th>
          <th>المادة</th>
          <th>اسم الملف</th>
          <th>كلمة المرور</th>
          <th>الحالة</th>
          <th>الإجراء</th>
        </tr>
      </thead>
      <tbody id="uploadsTable"></tbody>
    </table>
  </div>

  <div id="tab-browser-files" style="display:none;">
    <table class="user-table">
      <thead>
        <tr>
          <th>المسار</th>
          <th>اسم الملف</th>
          <th>الرافع</th>
          <th>كلمة المرور</th>
          <th>الحالة</th>
          <th>الإجراء</th>
        </tr>
      </thead>
      <tbody id="browserFilesTable"></tbody>
    </table>
  </div>

  <script>
    function logoutUser() {
      localStorage.removeItem("currentUser");
      window.location.href = "login.html";
    }

    function goToSite() {
      window.location.href = "index.html";
    }

    function showTab(tab) {
      document.getElementById("tab-users").style.display = tab === "users" ? "block" : "none";
      document.getElementById("tab-uploads").style.display = tab === "uploads" ? "block" : "none";
      document.getElementById("tab-browser-files").style.display = tab === "browser-files" ? "block" : "none";
    }

    function loadUsers() {
      const users = JSON.parse(localStorage.getItem("users") || "[]");
      const tbody = document.getElementById("userTable");
      tbody.innerHTML = "";

      users.forEach((user, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${user.username}</td>
          <td>${user.email}</td>
          <td>${user.password}</td>
          <td class="${user.approved ? 'status-approved' : 'status-pending'}">
            ${user.approved ? 'مقبول' : 'بانتظار'}
          </td>
          <td>
            ${user.approved ? '' : `<button class="approve-btn" onclick="approveUser(${index})">موافقة</button>`}
            <button class="delete-btn" onclick="deleteUser(${index})">🗑 حذف</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function approveUser(index) {
      const users = JSON.parse(localStorage.getItem("users") || "[]");
      users[index].approved = true;
      localStorage.setItem("users", JSON.stringify(users));
      loadUsers();
    }

    function deleteUser(index) {
      const users = JSON.parse(localStorage.getItem("users") || "[]");
      users.splice(index, 1);
      localStorage.setItem("users", JSON.stringify(users));
      loadUsers();
    }

    function loadUploads() {
      const uploads = JSON.parse(localStorage.getItem("uploads") || "[]");
      const tbody = document.getElementById("uploadsTable");
      tbody.innerHTML = "";

      uploads.forEach((upload, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${upload.year}</td>
          <td>${upload.subject}</td>
          <td>${upload.fileName}</td>
          <td class="${upload.approved ? 'status-approved' : 'status-pending'}">
            ${upload.approved ? 'مقبول' : 'بانتظار'}
          </td>
          <td>
            ${upload.approved ? 
              '<button class="approve-btn" disabled>تمت الموافقة</button>' :
              `<button class="approve-btn" onclick="approveUpload(${index})">موافقة</button>`}
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function approveUpload(index) {
      const uploads = JSON.parse(localStorage.getItem("uploads") || "[]");
      uploads[index].approved = true;
      localStorage.setItem("uploads", JSON.stringify(uploads));
      loadUploads();
    }

    function loadBrowserFiles() {
      const files = JSON.parse(localStorage.getItem("browserFiles") || "[]");
      const tbody = document.getElementById("browserFilesTable");
      tbody.innerHTML = "";

      files.forEach((file, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${file.path}</td>
          <td>${file.name}</td>
          <td>${file.uploadedBy}</td>
          <td class="${file.approved ? 'status-approved' : 'status-pending'}">
            ${file.approved ? 'مقبول' : 'بانتظار'}
          </td>
          <td>
            ${file.approved ? 
              '<button class="approve-btn" disabled>تمت الموافقة</button>' :
              `<button class="approve-btn" onclick="approveBrowserFile(${index})">موافقة</button>`}
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function approveBrowserFile(index) {
      const files = JSON.parse(localStorage.getItem("browserFiles") || "[]");
      files[index].approved = true;
      localStorage.setItem("browserFiles", JSON.stringify(files));
      loadBrowserFiles();
    }

    document.addEventListener("DOMContentLoaded", () => {
      const currentUser = JSON.parse(localStorage.getItem("currentUser") || "null");
      if (!(currentUser && currentUser.username === "latifking" && currentUser.password === "ding2010")) {
        window.location.href = "login.html";
      }

      loadUsers();
      loadUploads();
      loadBrowserFiles();
    });
  </script>
</body>
</html>