
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body style="font-family: Arial; max-width: 600px; margin: auto; padding-top: 60px;">
  <h2>ğŸ“¤ Ø±ÙØ¹ Ù…Ù„Ù ÙˆÙˆØ±Ø¯</h2>
  <label>Ø§Ø®ØªØ± Ø§Ù„Ø·ÙˆØ±:</label>
  <select id="stage">
    <option value="primary">Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
    <option value="middle">Ù…ØªÙˆØ³Ø·</option>
    <option value="secondary">Ø«Ø§Ù†ÙˆÙŠ</option>
  </select><br><br>
  <label>Ø§Ù„Ø³Ù†Ø©:</label><input type="text" id="year" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø³Ù†Ø©-Ø§Ù„Ø«Ø§Ù†ÙŠØ©" /><br><br>
  <label>Ø§Ù„Ù…Ø§Ø¯Ø©:</label><input type="text" id="subject" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù„ØºØ©-Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" /><br><br>
  <input type="file" id="fileInput" accept=".doc,.docx" />
  <button onclick="upload()">Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù</button>
  <p id="msg"></p>

  <script>
    async function upload() {
      const file = document.getElementById('fileInput').files[0];
      const stage = document.getElementById('stage').value;
      const year = document.getElementById('year').value.trim();
      const subject = document.getElementById('subject').value.trim();
      const msg = document.getElementById('msg');

      if (!file || !year || !subject) {
        msg.innerText = "â— Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù.";
        return;
      }

      if (!file.name.endsWith('.doc') && !file.name.endsWith('.docx')) {
        msg.innerText = 'âŒ ÙŠØ¬Ø¨ Ø±ÙØ¹ Ù…Ù„ÙØ§Øª ÙˆÙˆØ±Ø¯ ÙÙ‚Ø· (.doc, .docx)';
        return;
      }

      const reader = new FileReader();
      reader.onload = async function() {
        const base64File = reader.result.split(',')[1];
        const path = `data/${stage}/${year}/${subject}/${file.name}`;
        const token = localStorage.getItem('github_token');
        if (!token) {
          msg.innerText = "âŒ Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„.";
          return;
        }

        const res = await fetch(`https://api.github.com/repos/linnkou/majani/contents/${path}`, {
          method: "PUT",
          headers: {
            "Authorization": "token " + token,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
            content: base64File,
            branch: "main"
          })
        });

        if (res.ok) {
          msg.innerText = "âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!";
        } else {
          const err = await res.json();
          msg.innerText = "âŒ ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù: " + (err.message || "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ");
        }
      };
      reader.readAsDataURL(file);
    }
  </script>
</body>
</html>
