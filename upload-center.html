<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ“¤ Ù…Ø±ÙƒØ² Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --primary-color: #0072ff;
      --primary-hover: #005fcc;
      --bg-light: #f5f7f9;
      --card-bg-light: white;
      --text-color-light: #333;
      --input-border-light: #ccc;
      --success-color: #4CAF50;
      --warning-color: #ff9800;
      --error-color: #f44336;
    }
    
    @media (prefers-color-scheme: dark) {
      :root {
        --primary-color: #5D5CDE;
        --primary-hover: #4a49c0;
        --bg-light: #181818;
        --card-bg-light: #242424;
        --text-color-light: #e0e0e0;
        --input-border-light: #444;
      }
    }
    
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #83a4d4, #b6fbff);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      color: var(--text-color-light);
      background-color: var(--bg-light);
    }
    
    .dark body {
      background: linear-gradient(to right, #121212, #1f1f1f);
    }
    
    .card {
      background-color: var(--card-bg-light);
      border-radius: 12px;
      padding: 30px;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    
    h2 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-top: 15px;
      margin-bottom: 5px;
      font-weight: 500;
    }
    
    select, input[type="file"], input[type="text"], button {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid var(--input-border-light);
      font-size: 15px;
      background-color: var(--card-bg-light);
      color: var(--text-color-light);
    }
    
    select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url('data:image/svg+xml;utf8,<svg fill="%23666" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
      background-repeat: no-repeat;
      background-position: left 12px center;
      background-size: 20px;
      padding-left: 40px;
    }
    
    select:disabled {
      background-color: rgba(0,0,0,0.05);
      cursor: not-allowed;
    }
    
    button {
      background-color: var(--primary-color);
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: var(--primary-hover);
    }
    
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    
    #msg {
      text-align: center;
      margin-top: 15px;
      padding: 10px;
      border-radius: 5px;
      transition: all 0.3s ease;
    }
    
    .success {
      background-color: rgba(76, 175, 80, 0.1);
      color: var(--success-color);
      border: 1px solid rgba(76, 175, 80, 0.2);
    }
    
    .warning {
      background-color: rgba(255, 152, 0, 0.1);
      color: var(--warning-color);
      border: 1px solid rgba(255, 152, 0, 0.2);
    }
    
    .error {
      background-color: rgba(244, 67, 54, 0.1);
      color: var(--error-color);
      border: 1px solid rgba(244, 67, 54, 0.2);
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(0,0,0,0.1);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .hidden {
      display: none;
    }
    
    .upload-path {
      background-color: rgba(0,0,0,0.05);
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 15px;
      font-family: monospace;
      word-break: break-all;
    }
    
    .upload-path-label {
      font-weight: bold;
      margin-bottom: 5px;
      display: block;
    }
    
    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    
    .nav-btn {
      padding: 10px 15px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .nav-btn:hover {
      background-color: var(--primary-hover);
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ“¤ Ù…Ø±ÙƒØ² Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª</h2>
    
    <label for="phase">Ø§Ù„Ø·ÙˆØ± Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ:</label>
    <select id="phase" onchange="loadYears()">
      <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø·ÙˆØ± --</option>
      <option value="Ø§Ù„Ø·ÙˆØ± Ø§Ù„Ø¥Ø¨ØªØ¯Ø§Ø¦ÙŠ">Ø§Ù„Ø·ÙˆØ± Ø§Ù„Ø¥Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
      <option value="Ø§Ù„Ø·ÙˆØ± Ø§Ù„Ù…ØªÙˆØ³Ø·">Ø§Ù„Ø·ÙˆØ± Ø§Ù„Ù…ØªÙˆØ³Ø·</option>
      <option value="Ø§Ù„Ø·ÙˆØ± Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ">Ø§Ù„Ø·ÙˆØ± Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
    </select>

    <label for="year">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</label>
    <select id="year" onchange="loadSubjects()" disabled>
      <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø³Ù†Ø© --</option>
    </select>

    <label for="subject">Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</label>
    <select id="subject" onchange="loadSubfolders()" disabled>
      <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© --</option>
    </select>
    
    <label for="customSubject">Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©:</label>
    <input type="text" id="customSubject" placeholder="(Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©" />

    <label for="subfolder">Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„ÙØ±Ø¹ÙŠ:</label>
    <select id="subfolder" disabled>
      <option value="">-- Ø¨Ø¯ÙˆÙ† Ù…Ø¬Ù„Ø¯ ÙØ±Ø¹ÙŠ --</option>
    </select>
    
    <label for="customSubfolder">Ø£Ùˆ Ø£Ø¶Ù Ù…Ø¬Ù„Ø¯Ù‹Ø§ ÙØ±Ø¹ÙŠÙ‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§:</label>
    <input type="text" id="customSubfolder" placeholder="(Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…Ø¬Ù„Ø¯ ÙØ±Ø¹ÙŠ Ø¬Ø¯ÙŠØ¯" />

    <label for="type">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù:</label>
    <select id="type">
      <option value="ÙØ±Ø¶">ÙØ±Ø¶</option>
      <option value="Ø§Ø®ØªØ¨Ø§Ø±">Ø§Ø®ØªØ¨Ø§Ø±</option>
      <option value="Ù…Ø±Ø§Ø¬Ø¹Ø©">Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
      <option value="Ø¯Ø±Ø³">Ø¯Ø±Ø³</option>
      <option value="Ù…Ø°ÙƒØ±Ø©">Ù…Ø°ÙƒØ±Ø©</option>
      <option value="Ù…Ù„Ø®Øµ">Ù…Ù„Ø®Øµ</option>
      <option value="ØªÙ…Ø§Ø±ÙŠÙ†">ØªÙ…Ø§Ø±ÙŠÙ†</option>
      <option value="ÙˆØ§Ø¬Ø¨">ÙˆØ§Ø¬Ø¨ Ù…Ù†Ø²Ù„ÙŠ</option>
      <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
    </select>

    <div id="uploadPathContainer" class="hidden">
      <div class="upload-path-label">Ù…Ø³Ø§Ø± Ø§Ù„Ø±ÙØ¹:</div>
      <div id="uploadPath" class="upload-path"></div>
    </div>

    <input type="file" id="fileInput" />
    <button id="uploadBtn" onclick="upload()">Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù</button>
    <div id="msg"></div>
    
    <div class="navigation-buttons">
      <a href="home.html" class="nav-btn">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>
  </div>

  <script>
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ø¸Ù„Ø§Ù…
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
      if (event.matches) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    });
  
    // Ø§Ù„Ø«ÙˆØ§Ø¨Øª ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª
    const token = localStorage.getItem("github_token");
    const isAdmin = localStorage.getItem("isAdmin") === "true";
    const loggedUser = JSON.parse(localStorage.getItem("loggedUser") || "null");
    const repo = "majani";
    const owner = "linnkou";
    const apiBase = `https://api.github.com/repos/${owner}/${repo}/contents`;
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    if (!isAdmin && !loggedUser) {
      window.location.href = "login.html";
    }
    
    // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ© ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const phaseSelect = document.getElementById("phase");
    const yearSelect = document.getElementById("year");
    const subjectSelect = document.getElementById("subject");
    const customSubjectInput = document.getElementById("customSubject");
    const subfolderSelect = document.getElementById("subfolder");
    const customSubfolderInput = document.getElementById("customSubfolder");
    const typeSelect = document.getElementById("type");
    const fileInput = document.getElementById("fileInput");
    const uploadBtn = document.getElementById("uploadBtn");
    const msgDiv = document.getElementById("msg");
    const uploadPathContainer = document.getElementById("uploadPathContainer");
    const uploadPathDiv = document.getElementById("uploadPath");
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø·ÙˆØ± Ø§Ù„Ù…Ø®ØªØ§Ø±
    async function loadYears() {
      const phase = phaseSelect.value;
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ­Ø¯ÙŠØ¯
      resetSelect(yearSelect, "-- Ø§Ø®ØªØ± Ø§Ù„Ø³Ù†Ø© --");
      resetSelect(subjectSelect, "-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© --");
      resetSelect(subfolderSelect, "-- Ø¨Ø¯ÙˆÙ† Ù…Ø¬Ù„Ø¯ ÙØ±Ø¹ÙŠ --");
      
      if (!phase) {
        yearSelect.disabled = true;
        return;
      }
      
      try {
        // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        showMessage("Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©...", "loading");
        yearSelect.disabled = true;
        
        // Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ù†ÙˆØ§Øª Ù…Ù† Ø®Ù„Ø§Ù„ API
        const response = await fetch(`${apiBase}/data/${phase}`, {
          headers: { 
            Accept: "application/vnd.github.v3+json",
            Authorization: token ? `token ${token}` : undefined
          }
        });
        
        if (!response.ok) {
          if (response.status === 404) {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ (Ù„Ù„Ø£Ø¯Ù…ÙŠÙ† ÙÙ‚Ø·)
            if (isAdmin) {
              await createFolder(`data/${phase}`);
              yearSelect.disabled = false;
              showMessage("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø·ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ø¶Ø§ÙØ© Ø³Ù†Ø© Ø¯Ø±Ø§Ø³ÙŠØ©.", "success");
            } else {
              showMessage("Ø§Ù„Ø·ÙˆØ± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„.", "error");
            }
            return;
          }
          throw new Error(`GitHub API error: ${response.status}`);
        }
        
        const directories = await response.json();
        
        // ØªØµÙÙŠØ© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
        const folders = directories.filter(item => item.type === "dir");
        
        if (folders.length === 0) {
          showMessage("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ù†ÙˆØ§Øª Ø¯Ø±Ø§Ø³ÙŠØ© Ù…ØªØ§Ø­Ø© Ø¨Ø¹Ø¯ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø·ÙˆØ±.", "warning");
        } else {
          // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
          folders.forEach(folder => {
            const option = document.createElement("option");
            option.value = folder.name;
            option.textContent = folder.name.replace(/-/g, " ");
            yearSelect.appendChild(option);
          });
          
          clearMessage();
        }
      } catch (error) {
        console.error("Error loading years:", error);
        showMessage("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©.", "error");
      } finally {
        yearSelect.disabled = false;
        updateUploadPath();
      }
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
    async function loadSubjects() {
      const phase = phaseSelect.value;
      const year = yearSelect.value;
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ­Ø¯ÙŠØ¯
      resetSelect(subjectSelect, "-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© --");
      resetSelect(subfolderSelect, "-- Ø¨Ø¯ÙˆÙ† Ù…Ø¬Ù„Ø¯ ÙØ±Ø¹ÙŠ --");
      
      if (!phase || !year) {
        subjectSelect.disabled = true;
        return;
      }
      
      try {
        // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        showMessage("Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©...", "loading");
        subjectSelect.disabled = true;
        
        // Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ù…Ù† Ø®Ù„Ø§Ù„ API
        const response = await fetch(`${apiBase}/data/${phase}/${year}`, {
          headers: { 
            Accept: "application/vnd.github.v3+json",
            Authorization: token ? `token ${token}` : undefined
          }
        });
        
        if (!response.ok) {
          if (response.status === 404) {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ (Ù„Ù„Ø£Ø¯Ù…ÙŠÙ† ÙÙ‚Ø·)
            if (isAdmin) {
              await createFolder(`data/${phase}/${year}`);
              subjectSelect.disabled = false;
              showMessage("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¯Ø±Ø§Ø³ÙŠØ©.", "success");
            } else {
              showMessage("Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„.", "error");
            }
            return;
          }
          throw new Error(`GitHub API error: ${response.status}`);
        }
        
        const directories = await response.json();
        
        // ØªØµÙÙŠØ© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
        const folders = directories.filter(item => item.type === "dir");
        
        if (folders.length === 0) {
          showMessage("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ø¯Ø±Ø§Ø³ÙŠØ© Ù…ØªØ§Ø­Ø© Ø¨Ø¹Ø¯ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø©.", "warning");
        } else {
          // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
          folders.forEach(folder => {
            const option = document.createElement("option");
            option.value = folder.name;
            option.textContent = folder.name.replace(/-/g, " ");
            subjectSelect.appendChild(option);
          });
          
          clearMessage();
        }
      } catch (error) {
        console.error("Error loading subjects:", error);
        showMessage("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©.", "error");
      } finally {
        subjectSelect.disabled = false;
        updateUploadPath();
      }
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
    async function loadSubfolders() {
      const phase = phaseSelect.value;
      const year = yearSelect.value;
      const subject = subjectSelect.value;
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ­Ø¯ÙŠØ¯
      resetSelect(subfolderSelect, "-- Ø¨Ø¯ÙˆÙ† Ù…Ø¬Ù„Ø¯ ÙØ±Ø¹ÙŠ --");
      
      if (!phase || !year || !subject) {
        subfolderSelect.disabled = true;
        return;
      }
      
      try {
        // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        showMessage("Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ©...", "loading");
        subfolderSelect.disabled = true;
        
        // Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© Ù…Ù† Ø®Ù„Ø§Ù„ API
        const response = await fetch(`${apiBase}/data/${phase}/${year}/${subject}`, {
          headers: { 
            Accept: "application/vnd.github.v3+json",
            Authorization: token ? `token ${token}` : undefined
          }
        });
        
        if (!response.ok) {
          if (response.status === 404) {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ (Ù„Ù„Ø£Ø¯Ù…ÙŠÙ† ÙÙ‚Ø·)
            if (isAdmin) {
              await createFolder(`data/${phase}/${year}/${subject}`);
              subfolderSelect.disabled = false;
              showMessage("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ø¶Ø§ÙØ© Ù…Ù„ÙØ§Øª.", "success");
            } else {
              showMessage("Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„.", "error");
            }
            return;
          }
          throw new Error(`GitHub API error: ${response.status}`);
        }
        
        const directories = await response.json();
        
        // ØªØµÙÙŠØ© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
        const folders = directories.filter(item => item.type === "dir");
        
        if (folders.length === 0) {
          showMessage("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¬Ù„Ø¯Ø§Øª ÙØ±Ø¹ÙŠØ© Ù…ØªØ§Ø­Ø© Ø¨Ø¹Ø¯ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©.", "info");
        } else {
          // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
          folders.forEach(folder => {
            const option = document.createElement("option");
            option.value = folder.name;
            option.textContent = folder.name.replace(/-/g, " ");
            subfolderSelect.appendChild(option);
          });
          
          clearMessage();
        }
      } catch (error) {
        console.error("Error loading subfolders:", error);
        showMessage("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ©.", "error");
      } finally {
        subfolderSelect.disabled = false;
        updateUploadPath();
      }
    }
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø¬Ø¯ÙŠØ¯
    async function createFolder(path) {
      try {
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù .gitkeep Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯
        const response = await fetch(`${apiBase}/${path}/.gitkeep`, {
          method: "PUT",
          headers: {
            Accept: "application/vnd.github.v3+json",
            Authorization: `token ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: `Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯: ${path}`,
            content: "IyBJZ25vcmUgdGhpcyBmaWxlCg==", // base64 encoded "# Ignore this file"
            branch: "main"
          })
        });
        
        if (!response.ok) {
          throw new Error(`GitHub API error: ${response.status}`);
        }
        
        return await response.json();
      } catch (error) {
        console.error("Error creating folder:", error);
        throw error;
      }
    }
    
    // Ø¹Ù…Ù„ÙŠØ© Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
    async function upload() {
      // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      const phase = phaseSelect.value;
      const year = yearSelect.value;
      const subject = subjectSelect.value;
      const customSubject = customSubjectInput.value.trim().replace(/\s+/g, "-");
      const subfolder = subfolderSelect.value;
      const customSubfolder = customSubfolderInput.value.trim().replace(/\s+/g, "-");
      const type = typeSelect.value;
      const file = fileInput.files[0];
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      if (!phase) {
        return showMessage("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·ÙˆØ± Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ.", "error");
      }
      
      if (!year) {
        return showMessage("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©.", "error");
      }
      
      const finalSubject = customSubject || subject;
      if (!finalSubject) {
        return showMessage("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø£Ùˆ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©.", "error");
      }
      
      if (!file) {
        return showMessage("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù„Ù„Ø±ÙØ¹.", "error");
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³Ø§Ø± Ø§Ù„Ø±ÙØ¹
      let folderPath = `data/${phase}/${year}/${finalSubject}`;
      const finalSubfolder = customSubfolder || subfolder;
      
      if (finalSubfolder) {
        folderPath += `/${finalSubfolder}`;
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
      const fileName = `${type}-${file.name}`;
      const fullFilePath = `${folderPath}/${fileName}`;
      
      // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø±ÙØ¹ (Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø£Ø¯Ù…ÙŠÙ†ØŒ Ø£Ùˆ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†)
      const uploadPath = isAdmin ? fullFilePath : `pending_uploads/${fileName}`;
      
      try {
        // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        showMessage("Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù...", "loading");
        uploadBtn.disabled = true;
        
        // Ù‚Ø±Ø§Ø¡Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù
        const content = await readFileAsBase64(file);
        
        // Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ GitHub
        const response = await fetch(`${apiBase}/${uploadPath}`, {
          method: "PUT",
          headers: {
            Accept: "application/vnd.github.v3+json",
            Authorization: `token ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: `Ø±ÙØ¹ Ù…Ù„Ù Ù…Ù† Ù…Ø±ÙƒØ² Ø§Ù„Ø±ÙØ¹: ${fileName}`,
            content: content,
            branch: "main"
          })
        });
        
        if (!response.ok) {
          throw new Error(`GitHub API error: ${response.status}`);
        }
        
        // Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
        if (isAdmin) {
          showMessage(`ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰: ${folderPath}`, "success");
        } else {
          showMessage("ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„.", "success");
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        fileInput.value = "";
      } catch (error) {
        console.error("Error uploading file:", error);
        showMessage("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", "error");
      } finally {
        uploadBtn.disabled = false;
      }
    }
    
    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù ÙƒÙ€ Base64
    function readFileAsBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          const content = reader.result.split(',')[1]; // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¬Ø²Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† URL Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          resolve(content);
        };
        reader.onerror = error => reject(error);
        reader.readAsDataURL(file);
      });
    }
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
    function resetSelect(selectElement, defaultOption) {
      selectElement.innerHTML = '';
      const option = document.createElement("option");
      option.value = "";
      option.textContent = defaultOption;
      selectElement.appendChild(option);
      selectElement.disabled = true;
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ù…Ø³Ø§Ø± Ø§Ù„Ø±ÙØ¹
    function updateUploadPath() {
      const phase = phaseSelect.value;
      const year = yearSelect.value;
      const subject = subjectSelect.value || customSubjectInput.value.trim();
      const subfolder = subfolderSelect.value || customSubfolderInput.value.trim();
      const type = typeSelect.value;
      
      if (phase || year || subject) {
        let path = "data";
        
        if (phase) path += `/${phase}`;
        if (year) path += `/${year}`;
        if (subject) path += `/${subject}`;
        if (subfolder) path += `/${subfolder}`;
        if (type && fileInput.files.length > 0) {
          path += `/${type}-${fileInput.files[0].name}`;
        }
        
        uploadPathDiv.textContent = path;
        uploadPathContainer.classList.remove("hidden");
      } else {
        uploadPathContainer.classList.add("hidden");
      }
    }
    
    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function showMessage(message, type) {
      msgDiv.textContent = '';
      msgDiv.className = '';
      
      if (type === "loading") {
        const loader = document.createElement("span");
        loader.className = "loading";
        msgDiv.appendChild(loader);
        msgDiv.appendChild(document.createTextNode(message));
      } else {
        msgDiv.textContent = message;
        msgDiv.classList.add(type);
      }
    }
    
    // Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    function clearMessage() {
      msgDiv.textContent = '';
      msgDiv.className = '';
    }
    
    // Ù…Ø³ØªÙ…Ø¹Ùˆ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„ØªØ­Ø¯ÙŠØ« Ù…Ø³Ø§Ø± Ø§Ù„Ø±ÙØ¹
    phaseSelect.addEventListener("change", updateUploadPath);
    yearSelect.addEventListener("change", updateUploadPath);
    subjectSelect.addEventListener("change", updateUploadPath);
    subfolderSelect.addEventListener("change", updateUploadPath);
    customSubjectInput.addEventListener("input", updateUploadPath);
    customSubfolderInput.addEventListener("input", updateUploadPath);
    typeSelect.addEventListener("change", updateUploadPath);
    fileInput.addEventListener("change", updateUploadPath);
  </script>
</body>
</html>