// auth.js - Ù…Ù„Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©
function checkAuth() {
  // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  const currentPage = window.location.pathname.split('/').pop();
  
  // Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ØªØªØ·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
  const publicPages = ['index.html', 'login.html', 'register.html', ''];
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  const isAdmin = localStorage.getItem("isAdmin") === "true";
  const loggedUser = JSON.parse(localStorage.getItem("loggedUser") || "null");
  const isLoggedIn = isAdmin || loggedUser !== null;
  
  // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ ÙˆÙŠØ­Ø§ÙˆÙ„ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ù…Ø­Ù…ÙŠØ©
  if (!isLoggedIn && !publicPages.includes(currentPage)) {
    window.location.href = "login.html";
    return false;
  }
  
  // ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø¯Ù…ÙŠÙ† ÙÙ‚Ø·
  const adminPages = ['admin.html', 'manage-folders.html'];
  
  // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ØºÙŠØ± Ø§Ù„Ø£Ø¯Ù…ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† ÙŠØ­Ø§ÙˆÙ„ÙˆÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ ØµÙØ­Ø§Øª Ø§Ù„Ø£Ø¯Ù…ÙŠÙ†
  if (adminPages.includes(currentPage) {
    if (!isAdmin) {
      alert("ğŸš« Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙ‚Ø·.");
      window.location.href = "browse.html";
      return false;
    }
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ Ù…Ø¹ØªÙ…Ø¯Ù‹Ø§
  if (!isAdmin && loggedUser && loggedUser.status !== "approved" && !publicPages.includes(currentPage)) {
    alert("Ø­Ø³Ø§Ø¨Ùƒ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„ÙŠÙ‡.");
    localStorage.removeItem("loggedUser");
    window.location.href = "login.html";
    return false;
  }
  
  return true;
}

// ØªÙ†ÙÙŠØ° Ø§Ù„ÙØ­Øµ ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª
checkAuth();